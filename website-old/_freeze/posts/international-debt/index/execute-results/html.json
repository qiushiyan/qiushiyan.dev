{
  "hash": "51ef47e9992071717da8bd3393f357d2",
  "result": {
    "markdown": "---\ntitle: Analyzing International Debt Statistics\ndate: '2020-05-05'\ncategories: [misc]\ndescription: Analyze international debt from the World Bank using SQL, and make ggplot2 visulizations\nlast-modified: '2022-09-02'\nhtml-math-method:\n  method: plain\n---\n\n\nIn this post, I use SQL to retrieve and analyze international debt data collected by The World Bank. The dataset contains information about the amount of debt (in USD ðŸ’µ) owed by developing countries across several categories. In fact, I adopted this from one [DataCamp project](https://learn.datacamp.com/projects/754) without following its instructions. The project is still insightful and well-written, though.  Also, the R Markdown documentation has a section on how to [embed SQL chunks](https://bookdown.org/yihui/rmarkdown/language-engines.html#sqls)\n\n## SQL quries\n\n\n\n\n\nConnect to the postgres database using DBI.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(RPostgreSQL)\nlibrary(DBI)\n\ncon <- dbConnect(DBI::dbDriver(\"PostgreSQL\"),\n  dbname = \"qiushi\",\n  host = \"localhost\",\n  port = 5432,\n  user = Sys.getenv(\"PG_USER\"),\n  password = Sys.getenv(\"PG_PASSWORD\")\n)\n```\n:::\n\n\nAfter successful connection, let's start by `CREATE` the `international_debt` table, and load data into R as well.\n\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\nCREATE TABLE international_debt (\n\tcountry_name varchar(50),\n\tcountry_code varchar(10),\n\tindicator_name varchar(100),\n\tindicator_code varchar(20),\n\tdebt decimal(12, 1)\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(scales)\n\ninternational_debt <- readr::read_csv(\"https://media.githubusercontent.com/media/qiushiyan/blog-data/master/international_debt.csv\")\nsci_labeller <- label_number(scale_cut = cut_short_scale())\n```\n:::\n\n\n\nThen we can upload debt data into that table. If you happen to be a datacamp subscriber, [here](https://support.datacamp.com/hc/en-us/articles/360020444334-How-to-Download-Project-Datasets) are some instructions on how to download the data. ^[The following chunk is not a real SQL query but plain text. The knitr SQL engine currently only looks for the keywords that are among `INSERT`, `UPDATE`, `DELETE`, `CREATE` and `SELECT`. You have to run the command inside the database.]\n\n```sql\nCOPY international_debt\nFROM 'path/to/csv/file'\nWITH (FORMAT csv, header)\n```\n\n`international_debt` has debt information about 124 countries and 4714 rows in total, with each row being one type of debt statistics owed by one country or region.\n\n::: {.column-page}\n\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\n-- a glance a debt data\nSELECT *\nFROM international_debt\nLIMIT 10\n```\n\n\n<div class=\"knitsql-table\">\n\n\n|country_name |country_code |indicator_name                                                   |indicator_code |      debt|\n|:------------|:------------|:----------------------------------------------------------------|:--------------|---------:|\n|Afghanistan  |AFG          |Disbursements on external debt, long-term (DIS, current US$)     |DT.DIS.DLXF.CD |  72894454|\n|Afghanistan  |AFG          |Interest payments on external debt, long-term (INT, current US$) |DT.INT.DLXF.CD |  53239440|\n|Afghanistan  |AFG          |PPG, bilateral (AMT, current US$)                                |DT.AMT.BLAT.CD |  61739337|\n|Afghanistan  |AFG          |PPG, bilateral (DIS, current US$)                                |DT.DIS.BLAT.CD |  49114729|\n|Afghanistan  |AFG          |PPG, bilateral (INT, current US$)                                |DT.INT.BLAT.CD |  39903620|\n|Afghanistan  |AFG          |PPG, multilateral (AMT, current US$)                             |DT.AMT.MLAT.CD |  39107845|\n|Afghanistan  |AFG          |PPG, multilateral (DIS, current US$)                             |DT.DIS.MLAT.CD |  23779724|\n|Afghanistan  |AFG          |PPG, multilateral (INT, current US$)                             |DT.INT.MLAT.CD |  13335820|\n|Afghanistan  |AFG          |PPG, official creditors (AMT, current US$)                       |DT.AMT.OFFT.CD | 100847182|\n|Afghanistan  |AFG          |PPG, official creditors (DIS, current US$)                       |DT.DIS.OFFT.CD |  72894454|\n\n</div>\n:::\n\n\n:::\n\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\n-- how many countries\nSELECT COUNT(DISTINCT country_code) as n_countries FROM international_debt\n```\n\n\n<div class=\"knitsql-table\">\n\n\n| n_countries|\n|-----------:|\n|         124|\n\n</div>\n:::\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\n-- how many reords\nSELECT COUNT(*) AS n_records FROM international_debt\n```\n\n\n<div class=\"knitsql-table\">\n\n\n| n_records|\n|---------:|\n|      2357|\n\n</div>\n:::\n\n\n\n\nThe `indicator_code` column represents the category of these debts. Knowing about these various debt indicators will help us to understand the areas in which a country can possibly be indebted to.\n\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\nSELECT DISTINCT indicator_code, indicator_name FROM international_debt\n```\n\n\n<div class=\"knitsql-table\">\n\n\n|indicator_code |indicator_name                                                                        |\n|:--------------|:-------------------------------------------------------------------------------------|\n|DT.INT.PRVT.CD |PPG, private creditors (INT, current US$)                                             |\n|DT.AMT.OFFT.CD |PPG, official creditors (AMT, current US$)                                            |\n|DT.INT.DLXF.CD |Interest payments on external debt, long-term (INT, current US$)                      |\n|DT.INT.DPNG.CD |Interest payments on external debt, private nonguaranteed (PNG) (INT, current US$)    |\n|DT.DIS.PCBK.CD |PPG, commercial banks (DIS, current US$)                                              |\n|DT.AMT.PBND.CD |PPG, bonds (AMT, current US$)                                                         |\n|DT.DIS.MLAT.CD |PPG, multilateral (DIS, current US$)                                                  |\n|DT.DIS.PRVT.CD |PPG, private creditors (DIS, current US$)                                             |\n|DT.INT.MLAT.CD |PPG, multilateral (INT, current US$)                                                  |\n|DT.INT.PBND.CD |PPG, bonds (INT, current US$)                                                         |\n|DT.INT.PROP.CD |PPG, other private creditors (INT, current US$)                                       |\n|DT.DIS.OFFT.CD |PPG, official creditors (DIS, current US$)                                            |\n|DT.AMT.MLAT.CD |PPG, multilateral (AMT, current US$)                                                  |\n|DT.INT.OFFT.CD |PPG, official creditors (INT, current US$)                                            |\n|DT.DIS.PROP.CD |PPG, other private creditors (DIS, current US$)                                       |\n|DT.AMT.PCBK.CD |PPG, commercial banks (AMT, current US$)                                              |\n|DT.DIS.BLAT.CD |PPG, bilateral (DIS, current US$)                                                     |\n|DT.AMT.DLXF.CD |Principal repayments on external debt, long-term (AMT, current US$)                   |\n|DT.AMT.PROP.CD |PPG, other private creditors (AMT, current US$)                                       |\n|DT.AMT.PRVT.CD |PPG, private creditors (AMT, current US$)                                             |\n|DT.AMT.BLAT.CD |PPG, bilateral (AMT, current US$)                                                     |\n|DT.INT.PCBK.CD |PPG, commercial banks (INT, current US$)                                              |\n|DT.INT.BLAT.CD |PPG, bilateral (INT, current US$)                                                     |\n|DT.DIS.DLXF.CD |Disbursements on external debt, long-term (DIS, current US$)                          |\n|DT.AMT.DPNG.CD |Principal repayments on external debt, private nonguaranteed (PNG) (AMT, current US$) |\n\n</div>\n:::\n\n\nNow, I come to answer questions involving some simple calculations\n\n- What is the total amount of debt of all types? This is a measure of the health of the global economy.\n\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\nSELECT ROUND(SUM(debt), 2) AS total_debt FROM international_debt\n```\n\n\n<div class=\"knitsql-table\">\n\n\n| total_debt|\n|----------:|\n|   3.08e+12|\n\n</div>\n:::\n\n\n- Which country has the highest total debt?\n\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\nSELECT country_name, SUM(debt) AS total_debt\nFROM international_debt\nGROUP BY country_name\nORDER BY total_debt DESC\nLIMIT 20\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: Countries with highest debt\n\n|country_name                                 | total_debt|\n|:--------------------------------------------|----------:|\n|China                                        |  2.858e+11|\n|Brazil                                       |  2.806e+11|\n|South Asia                                   |  2.476e+11|\n|Least developed countries: UN classification |  2.129e+11|\n|Russian Federation                           |  1.913e+11|\n|IDA only                                     |  1.790e+11|\n|Turkey                                       |  1.511e+11|\n|India                                        |  1.336e+11|\n|Mexico                                       |  1.246e+11|\n|Indonesia                                    |  1.134e+11|\n|Cameroon                                     |  8.649e+10|\n|Angola                                       |  7.137e+10|\n|Kazakhstan                                   |  7.016e+10|\n|Egypt, Arab Rep.                             |  6.208e+10|\n|Vietnam                                      |  4.585e+10|\n|Colombia                                     |  4.543e+10|\n|Pakistan                                     |  4.514e+10|\n|Romania                                      |  4.281e+10|\n|South Africa                                 |  3.670e+10|\n|Venezuela, RB                                |  3.605e+10|\n\n</div>\n:::\n\n\nHere we see the top 20 countries with highest overall debt. In fact, some of the entries in `country_name` are not countries but regions, such \"South Asia\", \"Least developed countries: UN classification\" and \"IDA only\".\n\nNow that we know China is in most debt, we could break China's dbet down to see the proportion for which different types of loan accounted.\n\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\nSELECT  indicator_name, debt,\n        (debt / sum(debt) OVER()) AS proportion\nFROM international_debt\nWHERE country_name = 'China'\nORDER BY proportion DESC\n```\n\n\n<div class=\"knitsql-table\">\n\n\n|indicator_name                                                                        |      debt| proportion|\n|:-------------------------------------------------------------------------------------|---------:|----------:|\n|Principal repayments on external debt, long-term (AMT, current US$)                   | 9.622e+10|     0.3367|\n|Principal repayments on external debt, private nonguaranteed (PNG) (AMT, current US$) | 7.239e+10|     0.2533|\n|Interest payments on external debt, long-term (INT, current US$)                      | 1.787e+10|     0.0625|\n|Disbursements on external debt, long-term (DIS, current US$)                          | 1.569e+10|     0.0549|\n|PPG, private creditors (AMT, current US$)                                             | 1.468e+10|     0.0514|\n|Interest payments on external debt, private nonguaranteed (PNG) (INT, current US$)    | 1.414e+10|     0.0495|\n|PPG, bonds (AMT, current US$)                                                         | 9.835e+09|     0.0344|\n|PPG, official creditors (AMT, current US$)                                            | 9.148e+09|     0.0320|\n|PPG, bilateral (AMT, current US$)                                                     | 6.532e+09|     0.0229|\n|PPG, private creditors (DIS, current US$)                                             | 4.111e+09|     0.0144|\n|PPG, commercial banks (AMT, current US$)                                              | 4.046e+09|     0.0142|\n|PPG, commercial banks (DIS, current US$)                                              | 3.777e+09|     0.0132|\n|PPG, official creditors (DIS, current US$)                                            | 3.080e+09|     0.0108|\n|PPG, multilateral (DIS, current US$)                                                  | 3.080e+09|     0.0108|\n|PPG, multilateral (AMT, current US$)                                                  | 2.616e+09|     0.0092|\n|PPG, private creditors (INT, current US$)                                             | 2.351e+09|     0.0082|\n|PPG, official creditors (INT, current US$)                                            | 1.373e+09|     0.0048|\n|PPG, bonds (INT, current US$)                                                         | 1.224e+09|     0.0043|\n|PPG, commercial banks (INT, current US$)                                              | 9.699e+08|     0.0034|\n|PPG, multilateral (INT, current US$)                                                  | 8.584e+08|     0.0030|\n|PPG, other private creditors (AMT, current US$)                                       | 7.965e+08|     0.0028|\n|PPG, bilateral (INT, current US$)                                                     | 5.149e+08|     0.0018|\n|PPG, other private creditors (DIS, current US$)                                       | 3.340e+08|     0.0012|\n|PPG, other private creditors (INT, current US$)                                       | 1.563e+08|     0.0005|\n\n</div>\n:::\n\n\nTwo of all categories of debt, long-term and private nonguaranteed principle repayments  on external debt take up more than 50% of China's total debt.\n\nWe can dig even further to find out on an average how much debt a country owes. This will give us a better sense of the distribution of the amount of debt across different indicators.\n\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\nSELECT indicator_name, avg(debt) AS mean_debt\nFROM international_debt\nGROUP BY indicator_name\nORDER BY mean_debt DESC\n```\n\n\n<div class=\"knitsql-table\">\n\n\n|indicator_name                                                                        | mean_debt|\n|:-------------------------------------------------------------------------------------|---------:|\n|Principal repayments on external debt, long-term (AMT, current US$)                   | 5.905e+09|\n|Principal repayments on external debt, private nonguaranteed (PNG) (AMT, current US$) | 5.161e+09|\n|Disbursements on external debt, long-term (DIS, current US$)                          | 2.152e+09|\n|PPG, official creditors (DIS, current US$)                                            | 1.959e+09|\n|PPG, private creditors (AMT, current US$)                                             | 1.804e+09|\n|Interest payments on external debt, long-term (INT, current US$)                      | 1.644e+09|\n|PPG, bilateral (DIS, current US$)                                                     | 1.223e+09|\n|Interest payments on external debt, private nonguaranteed (PNG) (INT, current US$)    | 1.220e+09|\n|PPG, official creditors (AMT, current US$)                                            | 1.191e+09|\n|PPG, bonds (AMT, current US$)                                                         | 1.083e+09|\n|PPG, multilateral (DIS, current US$)                                                  | 8.398e+08|\n|PPG, bonds (INT, current US$)                                                         | 8.047e+08|\n|PPG, other private creditors (AMT, current US$)                                       | 7.469e+08|\n|PPG, commercial banks (AMT, current US$)                                              | 7.349e+08|\n|PPG, private creditors (INT, current US$)                                             | 7.197e+08|\n|PPG, bilateral (AMT, current US$)                                                     | 7.126e+08|\n|PPG, multilateral (AMT, current US$)                                                  | 4.901e+08|\n|PPG, private creditors (DIS, current US$)                                             | 3.113e+08|\n|PPG, official creditors (INT, current US$)                                            | 2.977e+08|\n|PPG, commercial banks (DIS, current US$)                                              | 2.933e+08|\n|PPG, bilateral (INT, current US$)                                                     | 1.641e+08|\n|PPG, commercial banks (INT, current US$)                                              | 1.566e+08|\n|PPG, multilateral (INT, current US$)                                                  | 1.362e+08|\n|PPG, other private creditors (DIS, current US$)                                       | 8.114e+07|\n|PPG, other private creditors (INT, current US$)                                       | 3.425e+07|\n\n</div>\n:::\n\n\nA bit of visualization might help here, I' ll make a density plot of mean debt across all indicators.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- international_debt %>%\n  group_by(indicator_name) %>%\n  summarize(mean_debt = mean(debt)) %>%\n  ggplot() +\n  geom_density(aes(mean_debt), fill = \"midnightblue\", alpha = 0.4) +\n  scale_x_continuous(labels = sci_labeller) +\n  theme_minimal() +\n  theme(axis.text.y = element_blank()) +\n  labs(\n    title = \"Distribution of the average debt across different indicators\",\n    y = NULL,\n    x = NULL\n  )\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=816}\n:::\n:::\n\n\nOne may notice that principle repayment of long term debts tops the table of average debt and debt proportion of China. As such, we can find the top 10 countries with highest amount of debt in the category of long term debts (`DT.AMT.DLXF.CD`)\n\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\nSELECT DISTINCT country_name\nFROM international_debt\nWHERE country_name IN (\n    SELECT country_name\n    FROM international_debt\n    WHERE indicator_code = 'DT.AMT.DLXF.CD'\n    ORDER BY debt DESC\n    LIMIT 10\n)\n```\n\n\n<div class=\"knitsql-table\">\n\n\n|country_name                                 |\n|:--------------------------------------------|\n|Indonesia                                    |\n|Turkey                                       |\n|China                                        |\n|India                                        |\n|Kazakhstan                                   |\n|Russian Federation                           |\n|Brazil                                       |\n|South Asia                                   |\n|Mexico                                       |\n|Least developed countries: UN classification |\n\n</div>\n:::\n\n\n\nWe saw that long-term debt is the topmost category when it comes to the average amount of debt. But is it the most common indicator in which the countries owe their debt?\n\n\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\nSELECT indicator_name, COUNT(indicator_name) As n_indicator\nFROM international_debt\nGROUP BY indicator_name\nORDER BY n_indicator DESC\n```\n\n\n<div class=\"knitsql-table\">\n\n\n|indicator_name                                                                        | n_indicator|\n|:-------------------------------------------------------------------------------------|-----------:|\n|PPG, multilateral (INT, current US$)                                                  |         124|\n|Principal repayments on external debt, long-term (AMT, current US$)                   |         124|\n|Interest payments on external debt, long-term (INT, current US$)                      |         124|\n|PPG, official creditors (INT, current US$)                                            |         124|\n|PPG, multilateral (AMT, current US$)                                                  |         124|\n|PPG, official creditors (AMT, current US$)                                            |         124|\n|Disbursements on external debt, long-term (DIS, current US$)                          |         123|\n|PPG, official creditors (DIS, current US$)                                            |         122|\n|PPG, bilateral (AMT, current US$)                                                     |         122|\n|PPG, bilateral (INT, current US$)                                                     |         122|\n|PPG, multilateral (DIS, current US$)                                                  |         120|\n|PPG, bilateral (DIS, current US$)                                                     |         113|\n|PPG, private creditors (AMT, current US$)                                             |          98|\n|PPG, private creditors (INT, current US$)                                             |          98|\n|PPG, commercial banks (INT, current US$)                                              |          84|\n|PPG, commercial banks (AMT, current US$)                                              |          84|\n|Principal repayments on external debt, private nonguaranteed (PNG) (AMT, current US$) |          79|\n|Interest payments on external debt, private nonguaranteed (PNG) (INT, current US$)    |          79|\n|PPG, bonds (AMT, current US$)                                                         |          69|\n|PPG, bonds (INT, current US$)                                                         |          69|\n|PPG, other private creditors (INT, current US$)                                       |          54|\n|PPG, other private creditors (AMT, current US$)                                       |          54|\n|PPG, private creditors (DIS, current US$)                                             |          53|\n|PPG, commercial banks (DIS, current US$)                                              |          51|\n|PPG, other private creditors (DIS, current US$)                                       |          19|\n\n</div>\n:::\n\n\nTurns out it is the second most common category of debt. But what is the average amount of the most common debt type, `DT.INT.OFFT.CD`?\n\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\nSELECT avg(debt) as mean_debt\nFROM international_debt\nWHERE indicator_code = 'DT.INT.OFFT.CD'\n```\n\n\n<div class=\"knitsql-table\">\n\n\n| mean_debt|\n|---------:|\n| 297677339|\n\n</div>\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=816}\n:::\n:::\n\n\n\nBy inspecting the six indicators in which all the countries listed in our dataset have taken debt (`n_indicator = 124`), we have a clue that all these countries are suffering from some common economic issues. Another problem is what is the most serious issues each country has? We can look into this by retrieving maximum of debt of all categories of each country.\n\n::: {.column-page}\n\n\n\n::: {.cell connection='con'}\n\n```{.sql .cell-code}\n-- some countries have tied max debt on multiple categories\nWITH max_debt AS (\n\tSELECT country_name, max(debt) AS maximum\n\tFROM international_debt\n\tGROUP BY country_name\n\tHAVING max(debt) <> 0\n)\nSELECT  max_debt.country_name, indicator_name, maximum FROM max_debt\n  LEFT JOIN (SELECT country_name, indicator_name, debt FROM international_debt) AS debt\n\tON max_debt.maximum = debt.debt\n\tAND max_debt.country_name = debt.country_name\nORDER BY maximum DESC\nLIMIT 20\n```\n\n\n<div class=\"knitsql-table\">\n\n\n|country_name                                 |indicator_name                                                      |   maximum|\n|:--------------------------------------------|:-------------------------------------------------------------------|---------:|\n|China                                        |Principal repayments on external debt, long-term (AMT, current US$) | 9.622e+10|\n|Brazil                                       |Principal repayments on external debt, long-term (AMT, current US$) | 9.004e+10|\n|Russian Federation                           |Principal repayments on external debt, long-term (AMT, current US$) | 6.659e+10|\n|Turkey                                       |Principal repayments on external debt, long-term (AMT, current US$) | 5.156e+10|\n|South Asia                                   |Principal repayments on external debt, long-term (AMT, current US$) | 4.876e+10|\n|Least developed countries: UN classification |Disbursements on external debt, long-term (DIS, current US$)        | 4.016e+10|\n|IDA only                                     |Disbursements on external debt, long-term (DIS, current US$)        | 3.453e+10|\n|India                                        |Principal repayments on external debt, long-term (AMT, current US$) | 3.192e+10|\n|Indonesia                                    |Principal repayments on external debt, long-term (AMT, current US$) | 3.092e+10|\n|Kazakhstan                                   |Principal repayments on external debt, long-term (AMT, current US$) | 2.748e+10|\n|Mexico                                       |Principal repayments on external debt, long-term (AMT, current US$) | 2.522e+10|\n|Cameroon                                     |Disbursements on external debt, long-term (DIS, current US$)        | 1.819e+10|\n|Romania                                      |Principal repayments on external debt, long-term (AMT, current US$) | 1.401e+10|\n|Colombia                                     |Principal repayments on external debt, long-term (AMT, current US$) | 1.199e+10|\n|Angola                                       |Principal repayments on external debt, long-term (AMT, current US$) | 1.107e+10|\n|Venezuela, RB                                |Principal repayments on external debt, long-term (AMT, current US$) | 9.879e+09|\n|Egypt, Arab Rep.                             |Principal repayments on external debt, long-term (AMT, current US$) | 9.692e+09|\n|Lebanon                                      |Principal repayments on external debt, long-term (AMT, current US$) | 9.507e+09|\n|South Africa                                 |Principal repayments on external debt, long-term (AMT, current US$) | 9.474e+09|\n|Bangladesh                                   |PPG, official creditors (DIS, current US$)                          | 9.051e+09|\n\n</div>\n:::\n\n\n:::\n\n## Visualization: countries in most debt\n\nFinally, let's make a plot again to show the top 20 countries with highest debt, as in table 1, plus the specific category in which they take highest debt in.\nThis time I exclude non-country entries.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# prepare data for plot\nmaximum_category <- international_debt %>%\n  group_by(country_name) %>%\n  slice_max(order_by = debt, n = 1) %>%\n  distinct(country_name, .keep_all = TRUE) %>%\n  select(country_name, indicator_name)\n\ncountries <- international_debt %>%\n  filter(!country_name %in% c(\n    \"South Asia\",\n    \"Least developed countries: UN classification\",\n    \"IDA only\"\n  )) %>%\n  group_by(country_name) %>%\n  summarize(total_debt = sum(debt)) %>%\n  slice_max(order_by = total_debt, n = 20) %>%\n  left_join(maximum_category)\n\ncountries\n#> # A tibble: 20 Ã— 3\n#>    country_name          total_debt indicator_name                              \n#>    <chr>                      <dbl> <chr>                                       \n#>  1 China              285793494734. Principal repayments on external debt, longâ€¦\n#>  2 Brazil             280623966141. Principal repayments on external debt, longâ€¦\n#>  3 Russian Federation 191289057259. Principal repayments on external debt, longâ€¦\n#>  4 Turkey             151125758035. Principal repayments on external debt, longâ€¦\n#>  5 India              133627060958. Principal repayments on external debt, longâ€¦\n#>  6 Mexico             124596786217. Principal repayments on external debt, longâ€¦\n#>  7 Indonesia          113435696694. Principal repayments on external debt, longâ€¦\n#>  8 Cameroon            86491206347. Disbursements on external debt, long-term (â€¦\n#>  9 Angola              71368842500. Principal repayments on external debt, longâ€¦\n#> 10 Kazakhstan          70159942694. Principal repayments on external debt, longâ€¦\n#> 11 Egypt, Arab Rep.    62077727757. Principal repayments on external debt, longâ€¦\n#> 12 Vietnam             45851299896. Principal repayments on external debt, longâ€¦\n#> 13 Colombia            45430117605. Principal repayments on external debt, longâ€¦\n#> 14 Pakistan            45139315399. Principal repayments on external debt, longâ€¦\n#> 15 Romania             42813979498. Principal repayments on external debt, longâ€¦\n#> 16 South Africa        36703940742. Principal repayments on external debt, longâ€¦\n#> 17 Venezuela, RB       36048260108. Principal repayments on external debt, longâ€¦\n#> 18 Bangladesh          35045492841. Disbursements on external debt, long-term (â€¦\n#> 19 Lebanon             29697872619. Principal repayments on external debt, longâ€¦\n#> 20 Ukraine             28490304100. Principal repayments on external debt, longâ€¦\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# plotting\nlibrary(ggchicklet)\nlibrary(ggtext)\nlibrary(showtext)\n\n# load fonts\nfont_add_google(\"Overpass Mono\", \"Overpass Mono\")\nfont_add_google(\"Roboto Condensed\", \"Roboto Condensed\")\nshowtext_auto()\n```\n:::\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nggplot(countries) +\n  geom_chicklet(\n    aes(\n      x = forcats::fct_reorder(country_name, total_debt),\n      y = total_debt,\n      fill = indicator_name\n    ),\n    color = NA, width = 0.8\n  ) +\n  geom_text(\n    aes(\n      country_name, total_debt,\n      label = sci_labeller(total_debt)),\n      color = \"white\", nudge_y = -10000000000, family = \"Overpass Mono\"\n  ) +\n  scale_y_continuous(labels = label_number(scale_cut = cut_short_scale(), prefix = \"$\")) +\n  hrbrthemes::theme_modern_rc() +\n  nord::scale_fill_nord(palette = \"afternoon_prarie\", name = NA) +\n  coord_flip(clip = \"off\") +\n  labs(\n    x = NULL,\n    y = NULL,\n    title = \"Top 20 Countries with Highest Total Debts\"\n  ) +\n  theme(\n    legend.position = \"none\",\n    plot.title = element_text(size = 28, family = \"Roboto Condensed\"),\n    plot.title.position = \"plot\",\n    plot.subtitle = element_markdown(family = \"Roboto Condensed\"),\n    axis.text.x = element_text(face = \"bold\", size = 14),\n    axis.text.y = element_text(face = \"bold\", size = 18),\n    panel.grid.major.y = element_blank()\n  )\n```\n\n::: {.cell-output-display}\n![highest contributions from long term <span style='color:#F0D8C0'>repayments</span> or <span style='color:#6078A8'>disbursements</span>](index_files/figure-html/unnamed-chunk-21-1.png){width=1344}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}